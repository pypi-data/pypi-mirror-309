"use strict";(self.webpackChunk_datalayer_core=self.webpackChunk_datalayer_core||[]).push([[9209],{49209:(e,o,s)=>{s.r(o),s.d(o,{LessonEdit:()=>u,default:()=>m});var t=s(74512),a=s(66029),r=s(99608),n=s(40809),i=s(23189),l=s(90180),c=s(78032),d=s(19409),h=s(69058);const u=()=>{const{lessonId:e}=(0,r.UO)();if(!e)return(0,t.jsx)(t.Fragment,{});const o=(0,d.aF)(),s=(0,n.useConfirm)(),u=(0,d.s0)(),m=(0,h.qX)(),p=(0,l.useNotebookStore)(),x=m.layout().space,y=(0,h.D1)().saveRequest,f=p.selectNotebookModel(e),{cloneLesson:v,getLesson:j,refreshLesson:k,updateNotebook:b,updateNotebookModel:g}=(0,d.YT)(),[B,C]=(0,a.useState)("editor"),{enqueueToast:N}=(0,d.pm)(),[T,F]=(0,a.useState)(),[S,L]=(0,a.useState)({name:"",description:""}),[I,w]=(0,a.useState)({name:void 0,description:void 0}),E=(e,o)=>{o.preventDefault(),m.layout().resetRightPortal(),C(e)};(0,a.useEffect)((()=>(m.layout().showBackdrop(),k(e).then((o=>{if(m.layout().hideBackdrop(),o.success){const o=j(e);o?(F(o),m.layout().setItem(o),L({name:o.name,description:o.description})):u("/")}})).finally((()=>{m.layout().hideBackdrop()})),()=>{F(void 0),p.reset(),m.layout().setItem(void 0)})),[e]),(0,a.useEffect)((()=>{y&&T&&f?.model?.cells&&(m.layout().showBackdrop("Saving the lesson..."),g(e,f.model.toJSON()).then((e=>{e.success&&(N("The lesson is successfully updated.",{variant:"success"}),m.layout().triggerItemsRefresh(),F({...T,nbformat:f.model.toJSON()}))})).finally((()=>{m.layout().hideBackdrop()})))}),[y]),(0,a.useEffect)((()=>{w({...I,name:void 0===S.name?void 0:S.name.length>2,description:void 0===S.description?void 0:S.description.length>2})}),[S]);const P=(0,a.useCallback)((async t=>{s({title:"Are you sure?",content:"Please confirm you want to clone this lesson in your private library."}).then((s=>{s&&(m.layout().showBackdrop(),v(e).then((e=>{m.layout().hideBackdrop(),e.success&&(N(e.message,{variant:"success"}),m.layout().triggerItemsRefresh(),u(`/${o?.handle}/library/lessons`))})).finally((()=>{m.layout().hideBackdrop()})))}))}),[s,T]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Pagehead,{children:(0,t.jsxs)(n.Box,{display:"flex",children:[(0,t.jsx)(n.Box,{flex:1,children:(0,t.jsx)(n.Heading,{sx:{fontSize:3},children:"Lesson editor"})}),"editor"===B&&(0,t.jsx)(n.Box,{children:(0,t.jsx)(c.Z$,{notebookId:e})}),T&&x&&(0,t.jsx)(n.Box,{children:(0,t.jsx)(n.Button,{variant:"invisible",size:"small",leadingVisual:i.jcu,onClick:P,children:"Clone"})})]})}),T&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.TabNav,{sx:{mt:3,mb:3},children:[(0,t.jsx)(n.TabNav.Link,{href:"",selected:"editor"===B,onClick:e=>E("editor",e),children:"Editor"}),(0,t.jsx)(n.TabNav.Link,{href:"",selected:"properties"===B,onClick:e=>E("properties",e),children:"Properties"})]}),"editor"===B&&(0,t.jsx)(n.Box,{children:T.nbformat&&(0,t.jsx)(l.Notebook,{id:e,height:"calc(100vh - 240px)",maxHeight:"calc(100vh - 240px)",cellMetadataPanel:!0,nbformat:T.nbformat,CellSidebar:l.CellSidebar})}),"properties"===B&&(0,t.jsx)(n.Box,{display:"grid",gridTemplateColumns:"1fr 1fr",children:(0,t.jsx)(n.Box,{children:(0,t.jsxs)(n.Box,{sx:{label:{marginTop:2}},children:[(0,t.jsxs)(n.FormControl,{children:[(0,t.jsx)(n.FormControl.Label,{children:"Name"}),(0,t.jsx)(n.TextInput,{block:!0,value:S.name,onChange:e=>{L((o=>({...o,name:e.target.value})))}}),!1===I.name&&(0,t.jsx)(n.FormControl.Validation,{variant:"error",children:"Name must have more than 2 characters."})]}),(0,t.jsxs)(n.FormControl,{children:[(0,t.jsx)(n.FormControl.Label,{children:"Description"}),(0,t.jsx)(n.Textarea,{block:!0,value:S.description,onChange:e=>{L((o=>({...o,description:e.target.value})))}}),!1===I.description&&(0,t.jsx)(n.FormControl.Validation,{variant:"error",children:"Description must have more than 2 characters."})]}),(0,t.jsx)(n.FormControl,{children:(0,t.jsx)(n.Button,{variant:"primary",disabled:!I.name||!I.description,sx:{marginTop:2},onClick:async()=>{m.layout().showBackdrop(),b(e,S.name,S.description).then((e=>{m.layout().hideBackdrop(),e.success&&(N("The lesson is successfully updated.",{variant:"success"}),m.layout().triggerItemsRefresh(),F({...T,name:S.name,description:S.description}))})).finally((()=>{m.layout().hideBackdrop()}))},children:"Update lesson"})})]})})})]})]})},m=u}}]);