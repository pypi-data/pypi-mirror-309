"use strict";(self.webpackChunk_datalayer_core=self.webpackChunk_datalayer_core||[]).push([[2241],{82241:(e,t,i)=>{i.r(t),i.d(t,{default:()=>U});var n=i(68337),s=i(48382),o=i(58280);const r="CompletionProvider:context";class l{constructor(){this.identifier=r,this.rank=500,this.renderer=null}async isApplicable(e){return!0}fetch(e,t){const i=t.editor;return i?new Promise((e=>{e(a.contextHint(i))})):Promise.reject("No editor")}}var a;!function(e){e.contextHint=function(e){const t=e.getTokenAtCursor(),i=function(e,t){return t.getTokens().filter((t=>0===t.value.indexOf(e.value)&&t.value!==e.value))}(t,e).filter((e=>e.type)).map((e=>e.value)),n=new Set(i),s=new Array;return n.forEach((e=>s.push({label:e}))),{start:t.offset,end:t.offset+t.value.length,items:s}}}(a||(a={}));var d=i(76437),c=i(18168),h=i(75753);class m{constructor(e){this.options=e,this.identifier="@jupyterlab/inline-completer:history",this._maxSuggestions=100;const t=e.translator||c.Sr;this._trans=t.load("jupyterlab")}get name(){return this._trans.__("History")}get icon(){return h.Dc}get schema(){return{properties:{maxSuggestions:{title:this._trans.__("Maximum number of suggestions"),description:this._trans.__("The maximum number of suggestions to retrieve from history."),type:"number"}},default:{enabled:!1,maxSuggestions:100}}}configure(e){var t;this._maxSuggestions=null!==(t=e.maxSuggestions)&&void 0!==t?t:100}async fetch(e,t,i){var n;const s=null===(n=t.session)||void 0===n?void 0:n.kernel;if(!s)throw new Error("No kernel for completion request.");const o=e.text.slice(0,e.offset).split("\n").slice(-1)[0],r={output:!1,raw:!0,hist_access_type:"search",pattern:o+"*",unique:!0,n:this._maxSuggestions},l=await s.requestHistory(r),a=[];if(""===o)return{items:[]};if("ok"===l.content.status)for(const e of l.content.history){const t=e[2].split("\n");for(let e=0;e<t.length;e++){const i=t[e];if(i.startsWith(o)){const n=i.slice(o.length,i.length)+"\n"+t.slice(e+1).join("\n");a.push({insertText:n})}}}return{items:a}}}var p,u=i(92279),v=i(98209),g=i(59965),_=i(66173),f=i(15487);class w{constructor(e){this.options=e}placeGhost(e,t){const i=[p.addMark.of(t)];e.state.field(p.markField,!1)||(i.push(f.Py.appendConfig.of([p.markField])),i.push(f.Py.appendConfig.of([_.tk.domEventHandlers({blur:t=>{if(!1===this.options.onBlur(t))return!0;const i=[p.removeMark.of(null)];setTimeout((()=>{e.dispatch({effects:i})}),0)}})]))),e.dispatch({effects:i})}clearGhosts(e){const t=[p.removeMark.of(null)];e.dispatch({effects:t})}}w.streamingAnimation="uncover";class C extends _.l9{constructor(e){super(),this.options=e,this.isSpacer=!1}eq(e){return e.content==this.content&&e.options.streaming===this.options.streaming}get lineBreaks(){return(this.content.match(/\n/g)||"").length}updateDOM(e,t){return this._updateDOM(e),!0}get content(){return this.options.content}toDOM(){let e=document.createElement("span");return this.options.onPointerOver&&e.addEventListener("pointerover",this.options.onPointerOver),this.options.onPointerLeave&&e.addEventListener("pointerleave",this.options.onPointerLeave),e.classList.add("jp-GhostText"),e.dataset.animation=w.streamingAnimation,e.dataset.providedBy=this.options.providerId,this._updateDOM(e),e}_updateDOM(e){const t=this.content;let i=this.options.addedPart;if(i&&!this.isSpacer){i.startsWith("\n")&&(i=i.substring(1)),e.innerText=t.substring(0,t.length-i.length);const n=document.createElement("span");n.className="jp-GhostText-streamedToken",n.innerText=i,e.appendChild(n)}else e.innerText=t;if(!this.isSpacer&&this.options.streaming){const t=document.createElement("span");t.className="jp-GhostText-streamingIndicator",e.appendChild(t)}}destroy(e){this.options.onPointerOver&&e.removeEventListener("pointerover",this.options.onPointerOver),this.options.onPointerLeave&&e.removeEventListener("pointerleave",this.options.onPointerLeave),super.destroy(e)}}class y extends C{constructor(){super(...arguments),this.isSpacer=!0}}class P extends y{toDOM(){const e=super.toDOM();return e.classList.add("jp-GhostText-lineSpacer"),e}}class x extends y{get content(){return this.options.content[0]}toDOM(){const e=super.toDOM();return e.classList.add("jp-GhostText-letterSpacer"),e}}!function(e){let t;function i(e,t){return _.p.widget({widget:new C(e),side:1,ghostSpec:e}).range(Math.min(e.from,t.newDoc.length),Math.min(e.from,t.newDoc.length))}!function(e){e[e.Set=0]="Set",e[e.Remove=1]="Remove",e[e.FilterAndUpdate=2]="FilterAndUpdate"}(t||(t={})),e.addMark=f.Py.define({map:(e,t)=>({...e,from:t.mapPos(e.from),to:t.mapPos(e.from+e.content.length)})}),e.removeMark=f.Py.define(),e.markField=f.QQ.define({create:()=>_.p.none,update(n,s){const o=function(i){for(let n of i.effects){if(n.is(e.addMark))return{action:t.Set,spec:n.value};if(n.is(e.removeMark))return{action:t.Remove}}return i.docChanged||i.selection?{action:t.FilterAndUpdate}:null}(s);if(n=n.update({filter:(e,t,i)=>!(i.spec.widget instanceof y&&i.spec.timeoutInfo.elapsed)}),!o)return n.map(s.changes);switch(o.action){case t.Set:{const e=i(o.spec,s);return n.update({add:[e],filter:(t,i,n)=>n===e.value})}case t.Remove:return n.update({filter:()=>!1});case t.FilterAndUpdate:{let e=n.iter();for(;e.value&&e.value.spec.widget instanceof y;)e.next();if(!e.value)return n.map(s.changes);const t=e.value.spec.ghostSpec,o={...t};let r=!1;s.changes.iterChanges(((e,t,i,n,s)=>{if(!r)if(e===t&&i!==n)for(let e=0;e<s.lines;e++){const t=s.lineAt(e).text,i=e>0?"\n"+t:t;if(!o.content.startsWith(i)){r=!0;break}o.content=o.content.slice(i.length),o.from+=i.length}else r=!0}));const l=r?function(e,t,i=1e3){if(e.content.length<2)return[];const n={elapsed:!1};setTimeout((()=>{n.elapsed=!0}),i);const s=_.p.widget({widget:new x(e),side:1,timeoutInfo:n}),o=_.p.widget({widget:new P(e),side:1,timeoutInfo:n});return[s.range(Math.min(e.from,t.newDoc.length),Math.min(e.from,t.newDoc.length)),o.range(Math.min(e.from,t.newDoc.length),Math.min(e.from,t.newDoc.length))]}(t,s):[i(o,s)],a=l.map((e=>e.value));if(n=n.update({add:l,filter:(e,t,i)=>a.includes(i)}),r)try{n=n.map(s.changes)}catch(e){return console.warn(e),_.p.none}return n}}},provide:e=>_.tk.decorations.from(e)})}(p||(p={}));const b="jp-mod-inline-completer-active",S="jp-InlineCompleter-hover";class I extends u.$L{constructor(e){var t,i;super({node:document.createElement("div")}),this._clearHoverTimeout=null,this._current=0,this._editor=null,this._lastItem=null,this._model=null,this._providerWidget=new u.$L,this._showShortcuts=I.defaultSettings.showShortcuts,this._showWidget=I.defaultSettings.showWidget,this._suggestionsCounter=new u.$L,this._toolbar=new s.o8,this.model=null!==(t=e.model)&&void 0!==t?t:null,this.editor=null!==(i=e.editor)&&void 0!==i?i:null,this.addClass("jp-InlineCompleter"),this._ghostManager=new w({onBlur:this._onEditorBlur.bind(this)}),this._trans=e.trans;const n=this.layout=new u.LN;n.addWidget(this._suggestionsCounter),n.addWidget(this.toolbar),n.addWidget(this._providerWidget),this._progressBar=document.createElement("div"),this._progressBar.className="jp-InlineCompleter-progressBar",this.node.appendChild(this._progressBar),this._updateShortcutsVisibility(),this._updateDisplay(),this.node.tabIndex=0}get toolbar(){return this._toolbar}get editor(){return this._editor}set editor(e){var t;null===(t=this.model)||void 0===t||t.reset(),this._editor=e}get model(){return this._model}set model(e){(e||this._model)&&e!==this._model&&(this._model&&(this._model.suggestionsChanged.disconnect(this._onModelSuggestionsChanged,this),this._model.filterTextChanged.disconnect(this._onModelFilterTextChanged,this),this._model.provisionProgress.disconnect(this._onProvisionProgress,this)),this._model=e,this._model&&(this._model.suggestionsChanged.connect(this._onModelSuggestionsChanged,this),this._model.filterTextChanged.connect(this._onModelFilterTextChanged,this),this._model.provisionProgress.connect(this._onProvisionProgress,this)))}cycle(e){var t,i;const n=null===(i=null===(t=this.model)||void 0===t?void 0:t.completions)||void 0===i?void 0:i.items;if(n){if("next"===e){const e=this._current+1;this._current=e===n.length?0:e}else{const e=this._current-1;this._current=-1===e?n.length-1:e}this._updateStreamTracking(),this._render()}}accept(){const e=this.model,t=this.current,i=this._editor;if(!i||!e||!t)return;const n=e.cursor,s=t.insertText,o=i.getOffsetAt(i.getCursorPosition()),r=i.getOffsetAt(n),l=r,a=o;i.model.sharedModel.updateSource(r,o,s),o<=a&&o>=l&&i.setCursorPosition(i.getPositionAt(l+s.length)),e.reset(),this.update()}get current(){var e;const t=null===(e=this.model)||void 0===e?void 0:e.completions;return t?t.items[this._current]:null}_updateStreamTracking(){this._lastItem&&this._lastItem.stream.disconnect(this._onStream,this);const e=this.current;e&&e.stream.connect(this._onStream,this),this._lastItem=e}_onStream(e,t){var i;const n=null===(i=this.model)||void 0===i?void 0:i.completions;if(!n||!n.items||0===n.items.length)return;if(this.isHidden)return;const s=n.items[this._current];this._setText(s)}configure(e){this._showWidget=e.showWidget,this._updateDisplay(),e.showShortcuts!==this._showShortcuts&&(this._showShortcuts=e.showShortcuts,this._updateShortcutsVisibility()),w.streamingAnimation=e.streamingAnimation}handleEvent(e){if(!this.isHidden&&this._editor)switch(e.type){case"pointerdown":this._evtPointerdown(e);break;case"scroll":this._evtScroll(e)}}onUpdateRequest(e){super.onUpdateRequest(e);const t=this._model;if(!t)return;let i=t.completions;i&&i.items&&0!==i.items.length?this.isHidden&&(this.show(),this._setGeometry()):this.isHidden||this.hide()}onAfterAttach(e){document.addEventListener("scroll",this,!0),document.addEventListener("pointerdown",this,!0)}onBeforeDetach(e){document.removeEventListener("scroll",this,!0),document.removeEventListener("pointerdown",this,!0)}_evtPointerdown(e){var t;if(this.isHidden||!this._editor)return;const i=e.target;if(this.node.contains(i))return!0;this.hide(),null===(t=this.model)||void 0===t||t.reset()}_evtScroll(e){if(this.isHidden||!this._editor)return;const{node:t}=this;t.contains(e.target)||requestAnimationFrame((()=>{this._setGeometry()}))}_onEditorBlur(e){var t;if(this.node.contains(e.relatedTarget))return!1;null===(t=this._editor)||void 0===t||t.host.classList.remove(b),this.hide()}_onModelSuggestionsChanged(e,t){var i;if(this.isAttached){if("set"===t.event)this._current=null!==(i=t.indexMap.get(this._current))&&void 0!==i?i:0;else if("clear"===t.event){const e=this.editor;e&&(this._ghostManager.clearGhosts(e.editor),e.host.classList.remove(b))}this._updateStreamTracking(),this.update(),this._render()}else this.update()}_onModelFilterTextChanged(e,t){var i,n;const s=null===(i=this.model)||void 0===i?void 0:i.completions;s&&s.items&&0!==s.items.length&&(this._current=null!==(n=t.get(this._current))&&void 0!==n?n:0,this._updateStreamTracking(),setTimeout((()=>{this._render(),this._setGeometry()}),0))}_onProvisionProgress(e,t){requestAnimationFrame((()=>{0===t.pendingProviders?this._progressBar.style.display="none":(this._progressBar.style.display="",this._progressBar.style.width=100*t.pendingProviders/t.totalProviders+"%")}))}_render(){var e,t;const i=null===(e=this.model)||void 0===e?void 0:e.completions;if(!i||!i.items||0===i.items.length)return;const n=i.items[this._current];this._setText(n),"never"!==this._showWidget&&(this._suggestionsCounter.node.innerText=this._trans.__("%1/%2",this._current+1,i.items.length),this._providerWidget.node.title=this._trans.__("Provider: %1",n.provider.name),(null!==(t=n.provider.icon)&&void 0!==t?t:h.Ec).render(this._providerWidget.node))}_setText(e){const t=e.insertText,i=this._editor,n=this._model;if(!n||!i)return;const s=i.editor;this._ghostManager.placeGhost(s,{from:i.getOffsetAt(n.cursor),content:t,providerId:e.provider.identifier,addedPart:e.lastStreamed,streaming:e.streaming,onPointerOver:this._onPointerOverGhost.bind(this),onPointerLeave:this._onPointerLeaveGhost.bind(this)}),i.host.classList.add(b)}_onPointerOverGhost(){null!==this._clearHoverTimeout&&(window.clearTimeout(this._clearHoverTimeout),this._clearHoverTimeout=null),this.node.classList.add(S)}_onPointerLeaveGhost(){this._clearHoverTimeout=window.setTimeout((()=>this.node.classList.remove(S)),500)}_setGeometry(){const{node:e}=this,t=this._model,i=this._editor;if(!i||!t||!t.cursor)return;const n=i.host.closest(".jp-MainAreaWidget > .lm-Widget")||i.host;let s;try{s=i.getCoordinateForPosition(t.cursor)}catch(e){return void this.hide()}g.Y.setGeometry({anchor:s,host:n,maxHeight:40,minHeight:20,node:e,privilege:"forceAbove",outOfViewDisplay:{top:"stick-outside",bottom:"stick-inside",left:"stick-inside",right:"stick-outside"}})}_updateShortcutsVisibility(){this.node.dataset.showShortcuts=this._showShortcuts+""}_updateDisplay(){this.node.dataset.display=this._showWidget}}!function(e){e.defaultSettings={showWidget:"onHover",showShortcuts:!0,streamingAnimation:"uncover",providers:{}},e.Model=class{constructor(){this.suggestionsChanged=new v.Signal(this),this.filterTextChanged=new v.Signal(this),this.provisionProgress=new v.Signal(this),this._isDisposed=!1,this._completions=null}setCompletions(e){var t,i;const n=new Map(null===(i=null===(t=this._completions)||void 0===t?void 0:t.items)||void 0===i?void 0:i.map(((e,t)=>[e.insertText,t])));this._completions=e;const s=new Map(e.items.map(((e,t)=>[n.get(e.insertText),t])));this.suggestionsChanged.emit({event:"set",indexMap:s})}appendCompletions(e){this._completions&&this._completions.items?(this._completions.items.push(...e.items),this.suggestionsChanged.emit({event:"append"})):console.warn("No completions to append to")}notifyProgress(e){this.provisionProgress.emit(e)}get cursor(){return this._cursor}set cursor(e){this._cursor=e}get completions(){return this._completions}reset(){this._completions=null,this.suggestionsChanged.emit({event:"clear"})}get isDisposed(){return this._isDisposed}handleTextChange(e){var t;const i=this._completions;if(!i||!i.items||0===i.items.length)return;const n=new Map(i.items.map(((e,t)=>[e,t])));for(let n of null!==(t=e.sourceChange)&&void 0!==t?t:[]){const e=n.insert;if(e){const t=i.items.filter((t=>{var i;const n=null!==(i=t.filterText)&&void 0!==i?i:t.insertText;return!!n.startsWith(e)&&(t.filterText=n.substring(e.length),t.insertText=t.insertText.substring(e.length),!0)}));0===t.length&&(this._completions=null),i.items=t}else n.retain||(this._completions=null)}const s=new Map(i.items.map(((e,t)=>[n.get(e),t])));this.filterTextChanged.emit(s)}handleSelectionChange(e){const t=this.cursor;if(!t)return;const{start:i,end:n}=e;i.column===n.column&&i.line===n.line||this.reset(),(i.line!==t.line||i.column<t.column)&&this.reset()}dispose(){this._isDisposed||(this._isDisposed=!0,v.Signal.clearData(this))}}}(I||(I={}));var k=i(88553),T=i(8505),M=i(38900),E=i(92627);class D{constructor(){this._activeProviders=new Set([d.R,r]),this._inlineCompleterSettings=I.defaultSettings,this._providers=new Map,this._inlineProviders=new Map,this._panelHandlers=new Map,this._mostRecentContext=new Map,this._activeProvidersChanged=new v.Signal(this),this._inlineCompleterFactory=null}get activeProvidersChanged(){return this._activeProvidersChanged}setTimeout(e){this._timeout=e}setShowDocumentationPanel(e){this._panelHandlers.forEach((t=>t.completer.showDocsPanel=e)),this._showDoc=e}setContinuousHinting(e){this._panelHandlers.forEach((t=>t.autoCompletion=e)),this._autoCompletion=e}registerProvider(e){const t=e.identifier;this._providers.has(t)?console.warn(`Completion provider with identifier ${t} is already registered`):(this._providers.set(t,e),this._panelHandlers.forEach(((e,t)=>{this.updateCompleter(this._mostRecentContext.get(t))})))}registerInlineProvider(e){const t=e.identifier;this._inlineProviders.has(t)?console.warn(`Completion provider with identifier ${t} is already registered`):(this._inlineProviders.set(t,e),this._panelHandlers.forEach(((e,t)=>{this.updateCompleter(this._mostRecentContext.get(t))})))}getProviders(){return this._providers}activateProvider(e){this._activeProviders=new Set([]),e.forEach((e=>{this._providers.has(e)&&this._activeProviders.add(e)})),0===this._activeProviders.size&&(this._activeProviders.add(d.R),this._activeProviders.add(r)),this._activeProvidersChanged.emit()}async updateCompleter(e){var t,i;const{widget:n,editor:s,sanitizer:o}=e,r=n.id,l=this._panelHandlers.get(r),a=[...this._activeProviders][0],d=this._providers.get(a);let c=null!==(t=null==d?void 0:d.renderer)&&void 0!==t?t:E.X.getDefaultRenderer(o);const h=null==d?void 0:d.modelFactory;let m;m=h?await h.call(d,e):new M.B,this._mostRecentContext.set(n.id,e);const p={model:m,editor:s,renderer:c,sanitizer:o,showDoc:this._showDoc};if(l){const t=l.completer;null===(i=t.model)||void 0===i||i.dispose(),t.model=p.model,t.renderer=p.renderer,t.showDocsPanel=p.showDoc,l.autoCompletion=this._autoCompletion,s&&(l.editor=s,l.reconciliator=await this.generateReconciliator(e))}else{const t=await this._generateHandler(e,p);this._panelHandlers.set(n.id,t),n.disposed.connect((e=>{this.disposeHandler(e.id,t),this._mostRecentContext.delete(r)}))}}invoke(e){const t=this._panelHandlers.get(e);t&&t.invoke()}select(e){const t=this._panelHandlers.get(e);t&&t.completer.selectActive()}setInlineCompleterFactory(e){this._inlineCompleterFactory=e,this._panelHandlers.forEach(((e,t)=>{this.updateCompleter(this._mostRecentContext.get(t))})),this.inline||(this.inline={invoke:e=>{const t=this._panelHandlers.get(e);t&&t.inlineCompleter&&t.invokeInline()},cycle:(e,t)=>{const i=this._panelHandlers.get(e);i&&i.inlineCompleter&&i.inlineCompleter.cycle(t)},accept:e=>{const t=this._panelHandlers.get(e);t&&t.inlineCompleter&&t.inlineCompleter.accept()},configure:e=>{this._inlineCompleterSettings=e,this._panelHandlers.forEach(((t,i)=>{for(const[t,i]of this._inlineProviders.entries())i.configure&&i.configure(e.providers[t]);t.inlineCompleter&&t.inlineCompleter.configure(e),this.updateCompleter(this._mostRecentContext.get(i))}))}})}get inlineProviders(){return[...this._inlineProviders.values()]}async generateReconciliator(e){const t=[];for(const[e,i]of Object.entries(this._inlineCompleterSettings.providers))!0===i.enabled&&t.push(e);const i=[...this._inlineProviders.values()].filter((e=>t.includes(e.identifier))),n=[];for(const e of this._activeProviders){const t=this._providers.get(e);t&&n.push(t)}return new k.K({context:e,providers:n,inlineProviders:i,inlineProvidersSettings:this._inlineCompleterSettings.providers,timeout:this._timeout})}disposeHandler(e,t){var i,n,s,o;null===(i=t.completer.model)||void 0===i||i.dispose(),t.completer.dispose(),null===(s=null===(n=t.inlineCompleter)||void 0===n?void 0:n.model)||void 0===s||s.dispose(),null===(o=t.inlineCompleter)||void 0===o||o.dispose(),t.dispose(),this._panelHandlers.delete(e)}async _generateHandler(e,t){const i=new E.X(t),n=this._inlineCompleterFactory?this._inlineCompleterFactory.factory({...t,model:new I.Model}):void 0;i.hide(),u.$L.attach(i,document.body),n&&(u.$L.attach(n,document.body),n.hide(),n.configure(this._inlineCompleterSettings));const s=await this.generateReconciliator(e),o=new T._({completer:i,inlineCompleter:n,reconciliator:s});return o.editor=e.editor,o}}var H=i(35909),A=i(56276),L=i(63070),O=i(56769);const j="availableProviders";function W(e){const{schema:t}=e,i=t.title,n=t.description,s=e.formContext.settings,o=s.get(j).user,r={...t.default};if(o)for(const e of Object.keys(r))r[e]=e in o?o[e]:-1;const[l,a]=(0,O.useState)(r);return O.createElement("div",null,O.createElement("fieldset",null,O.createElement("legend",null,i),O.createElement("p",{className:"field-description"},n),Object.keys(r).map((e=>O.createElement("div",{key:e,className:"form-group small-field"},O.createElement("div",null,O.createElement("h3",null," ",e),O.createElement("div",{className:"inputFieldWrapper"},O.createElement("input",{className:"form-control",type:"number",value:l[e],onChange:t=>{((e,t)=>{const i={...l,[e]:parseInt(t.target.value)};s.set(j,i).catch(console.error),a(i)})(e,t)}}))))))))}const R="@jupyterlab/completer-extension:manager",F="@jupyterlab/completer-extension:inline-completer";var B;!function(e){e.nextInline="inline-completer:next",e.previousInline="inline-completer:previous",e.acceptInline="inline-completer:accept",e.invokeInline="inline-completer:invoke"}(B||(B={}));const G={id:"@jupyterlab/completer-extension:base-service",description:"Adds context and kernel completion providers.",requires:[o.pl],autoStart:!0,activate:(e,t)=>{t.registerProvider(new l),t.registerProvider(new d.D)}},q={id:"@jupyterlab/completer-extension:inline-history",description:"Adds inline completion provider suggesting code from execution history.",requires:[o.pl],optional:[c.gv],autoStart:!0,activate:(e,t,i)=>{t.registerInlineProvider(new m({translator:null!=i?i:c.Sr}))}},N={id:"@jupyterlab/completer-extension:inline-completer-factory",description:"Provides a factory for inline completer.",provides:o.zp,optional:[c.gv],autoStart:!0,activate:(e,t)=>{const i=(t||c.Sr).load("jupyterlab");return{factory:t=>{const n=new I({...t,trans:i}),o=t=>{const i=e.commands.keyBindings.find((e=>e.command===t)),n=i?L.H.formatKeystroke(i.keys):"";return n?`${n}`:""},r={[B.previousInline]:o(B.previousInline),[B.nextInline]:o(B.nextInline),[B.acceptInline]:o(B.acceptInline)};return e.commands.keyBindingChanged.connect(((t,i)=>{const n=i.binding.command;if(r.hasOwnProperty(n)){const t=r[n],i=o(n);i!==t&&(r[n]=i,e.commands.notifyCommandChanged(n))}})),n.toolbar.addItem("previous-inline-completion",new s.oR({commands:e.commands,icon:h.Co,id:B.previousInline,label:()=>r[B.previousInline],caption:i.__("Previous")})),n.toolbar.addItem("next-inline-completion",new s.oR({commands:e.commands,icon:h.dz,id:B.nextInline,label:()=>r[B.nextInline],caption:i.__("Next")})),n.toolbar.addItem("accept-inline-completion",new s.oR({commands:e.commands,icon:h.eQ,id:B.acceptInline,label:()=>r[B.acceptInline],caption:i.__("Accept")})),n.model.suggestionsChanged.connect((()=>{for(const t of[B.previousInline,B.nextInline,B.acceptInline])e.commands.notifyCommandChanged(t)})),n}}}},$={id:F,description:"Registers the inline completer factory; adds inline completer commands, shortcuts and settings.",requires:[o.pl,o.zp,H.O],optional:[c.gv],autoStart:!0,activate:(e,t,i,s,o)=>{t.setInlineCompleterFactory(i);const r=(o||c.Sr).load("jupyterlab"),l=()=>!!e.shell.currentWidget&&!!t.inline;let a;e.commands.addCommand(B.nextInline,{execute:()=>{var i;null===(i=t.inline)||void 0===i||i.cycle(e.shell.currentWidget.id,"next")},label:r.__("Next Inline Completion"),isEnabled:l}),e.commands.addCommand(B.previousInline,{execute:()=>{var i;null===(i=t.inline)||void 0===i||i.cycle(e.shell.currentWidget.id,"previous")},label:r.__("Previous Inline Completion"),isEnabled:l}),e.commands.addCommand(B.acceptInline,{execute:()=>{var i;null===(i=t.inline)||void 0===i||i.accept(e.shell.currentWidget.id)},label:r.__("Accept Inline Completion"),isEnabled:()=>l()&&t.inline.isActive(e.shell.currentWidget.id)}),e.commands.addCommand(B.invokeInline,{execute:()=>{var i;null===(i=t.inline)||void 0===i||i.invoke(e.shell.currentWidget.id)},label:r.__("Invoke Inline Completer"),isEnabled:l});const d=e=>{var i;a=e.composite,null===(i=t.inline)||void 0===i||i.configure(a)};e.restored.then((()=>{var e;const i=null!==(e=t.inlineProviders)&&void 0!==e?e:[],n=e=>{var t,i;return{enabled:!0,timeout:5e3,debouncerDelay:0,...null!==(i=null===(t=e.schema)||void 0===t?void 0:t.default)&&void 0!==i?i:{}}};s.transform(F,{compose:e=>{var t,s;const o=null!==(t=e.data.composite.providers)&&void 0!==t?t:{};for(const e of i){const t=n(e);o[e.identifier]={...t,...null!==(s=o[e.identifier])&&void 0!==s?s:{}}}return e.data.composite.providers=o,e},fetch:e=>{var t,s;const o=e.schema.properties,l={};for(const e of i)l[e.identifier]={title:r.__("%1 provider",e.name),properties:{...null!==(s=null===(t=e.schema)||void 0===t?void 0:t.properties)&&void 0!==s?s:{},timeout:{title:r.__("Timeout"),description:r.__("Timeout for %1 provider (in milliseconds).",e.name),type:"number",minimum:0},debouncerDelay:{title:r.__("Debouncer delay"),minimum:0,description:r.__("Time since the last key press to wait before requesting completions from %1 provider (in milliseconds).",e.name),type:"number"},enabled:{title:r.__("Enabled"),description:r.__("Whether to fetch completions %1 provider.",e.name),type:"boolean"}},default:n(e),type:"object"};return o.providers.properties=l,e}}),s.load(F).then((e=>{d(e),e.changed.connect((e=>{d(e)}))})).catch(console.error)})).catch(console.error);const h=t=>e.commands.keyBindings.find((e=>e.command===t)),m={[B.acceptInline]:h(B.acceptInline),[B.invokeInline]:h(B.invokeInline)};e.commands.keyBindingChanged.connect(((e,t)=>{const i=t.binding.command;m.hasOwnProperty(i)&&(m[i]=h(i))})),document.addEventListener("keydown",(t=>{if(!(t.target instanceof Element))return;const i=t.target;switch(t.keyCode){case 9:{const s=[m[B.acceptInline],m[B.invokeInline]];for(const o of s)if(o&&1===o.keys.length&&"Tab"===o.keys[0]&&i.closest(o.selector)&&e.commands.isEnabled(o.command)){const s=i.closest("."+n.r3);if((null==a?void 0:a.suppressIfTabCompleterActive)&&s)return;return e.commands.execute(o.command).catch(console.error),t.preventDefault(),t.stopPropagation(),void t.stopImmediatePropagation()}break}default:return}}),!0)}},z={id:R,description:"Provides the completion provider manager.",requires:[H.O],optional:[A.C],provides:o.pl,autoStart:!0,activate:(e,t,i)=>{const n="availableProviders",s=new D,o=(e,t)=>{var i;const o=e.get(n),r=e.composite;s.setTimeout(r.providerTimeout),s.setShowDocumentationPanel(r.showDocumentationPanel),s.setContinuousHinting(r.autoCompletion),s.setSuppressIfInlineCompleterActive(r.suppressIfInlineCompleterActive);const l=null!==(i=o.user)&&void 0!==i?i:o.composite,a=Object.entries(null!=l?l:{}).filter((e=>e[1]>=0&&t.includes(e[0]))).sort((([,e],[,t])=>t-e)).map((e=>e[0]));s.activateProvider(a)};if(e.restored.then((()=>{const e=[...s.getProviders().entries()],i=e.map((([e,t])=>e));t.transform(R,{fetch:t=>{const i=t.schema.properties,s={};return e.forEach((([e,t],i)=>{var n;s[e]=null!==(n=t.rank)&&void 0!==n?n:10*(i+1)})),i[n].default=s,t}}),t.load(R).then((e=>{o(e,i),e.changed.connect((e=>{o(e,i)}))})).catch(console.error)})).catch(console.error),i){const e={fieldRenderer:e=>W(e)};i.addRenderer(`${R}.availableProviders`,e)}return s}},U=[z,G,q,N,$]},56276:(e,t,i)=>{i.d(t,{C:()=>s,E:()=>o});var n=i(47963);const s=new n.Token("@jupyterlab/ui-components:IFormRendererRegistry","A service for settings form renderer registration."),o=new n.Token("@jupyterlab/ui-components:ILabIconManager","A service to register and request icons.")}}]);