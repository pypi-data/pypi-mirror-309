import{r,a as p}from"./react-C1sqhVEE.js";import{H as N}from"./Helmet-BnirHtJg.js";import{O as g,P as l,a as R,b as S,c as P}from"./Pane-CmYQRGSJ.js";import{u as f,F as b,n as u}from"./index-Dowg_ARF.js";import{j as e,b as d,I as k,d as T,y as L,n as C}from"./ui-DwUtvhni.js";import{u as w,c as j,b as B}from"./reactQuery-DeUOlYhS.js";import{u as E}from"./useSystemSettingsQuery-QyAafPTs.js";import"./sentry-BKBnRIxx.js";import"./syntaxHighlighter-Bh-qY5cI.js";import"./reactRouter-kRt27ezR.js";function F({title:t,titleId:n,...a},o){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":n},a),t?r.createElement("title",{id:n},t):null,r.createElement("path",{fillRule:"evenodd",d:"M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z",clipRule:"evenodd"}))}const D=r.forwardRef(F);function O({title:t,titleId:n,...a},o){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":n},a),t?r.createElement("title",{id:n},t):null,r.createElement("path",{fillRule:"evenodd",d:"M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"}))}const Q=r.forwardRef(O);function W(){const t=f();return w(["system","dependencies"],()=>t.fetch("/system/dependencies").then(n=>n.json()))}function H(){const t=f();return w(["system","storage"],()=>t.fetch("/system/storage").then(n=>n.json()))}const h=["system","proxy"],v="/system/proxy";function M(){const t=f();return w(h,()=>t.fetch(v).then(n=>n.json()),{refetchInterval:5e3})}function z(){const t=j(),n=f();return B({mutationFn:a=>n.put(v,{body:JSON.stringify(a)}).then(o=>o.json()),onSuccess:a=>{t.setQueryData(h,a)}})}function I({title:t,titleId:n,...a},o){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":n},a),t?r.createElement("title",{id:n},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.25 9.75 16.5 12l-2.25 2.25m-4.5 0L7.5 12l2.25-2.25M6 20.25h12A2.25 2.25 0 0 0 20.25 18V6A2.25 2.25 0 0 0 18 3.75H6A2.25 2.25 0 0 0 3.75 6v12A2.25 2.25 0 0 0 6 20.25Z"}))}const A=r.forwardRef(I);function q({title:t,titleId:n,...a},o){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":n},a),t?r.createElement("title",{id:n},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 13.5h3.86a2.25 2.25 0 0 1 2.012 1.244l.256.512a2.25 2.25 0 0 0 2.013 1.244h3.218a2.25 2.25 0 0 0 2.013-1.244l.256-.512a2.25 2.25 0 0 1 2.013-1.244h3.859m-19.5.338V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 0 0-2.15-1.588H6.911a2.25 2.25 0 0 0-2.15 1.588L2.35 13.177a2.25 2.25 0 0 0-.1.661Z"}))}const V=r.forwardRef(q);function _({title:t,titleId:n,...a},o){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":n},a),t?r.createElement("title",{id:n},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.25 6.087c0-.355.186-.676.401-.959.221-.29.349-.634.349-1.003 0-1.036-1.007-1.875-2.25-1.875s-2.25.84-2.25 1.875c0 .369.128.713.349 1.003.215.283.401.604.401.959v0a.64.64 0 0 1-.657.643 48.39 48.39 0 0 1-4.163-.3c.186 1.613.293 3.25.315 4.907a.656.656 0 0 1-.658.663v0c-.355 0-.676-.186-.959-.401a1.647 1.647 0 0 0-1.003-.349c-1.036 0-1.875 1.007-1.875 2.25s.84 2.25 1.875 2.25c.369 0 .713-.128 1.003-.349.283-.215.604-.401.959-.401v0c.31 0 .555.26.532.57a48.039 48.039 0 0 1-.642 5.056c1.518.19 3.058.309 4.616.354a.64.64 0 0 0 .657-.643v0c0-.355-.186-.676-.401-.959a1.647 1.647 0 0 1-.349-1.003c0-1.035 1.008-1.875 2.25-1.875 1.243 0 2.25.84 2.25 1.875 0 .369-.128.713-.349 1.003-.215.283-.4.604-.4.959v0c0 .333.277.599.61.58a48.1 48.1 0 0 0 5.427-.63 48.05 48.05 0 0 0 .582-4.717.532.532 0 0 0-.533-.57v0c-.355 0-.676.186-.959.401-.29.221-.634.349-1.003.349-1.035 0-1.875-1.007-1.875-2.25s.84-2.25 1.875-2.25c.37 0 .713.128 1.003.349.283.215.604.401.96.401v0a.656.656 0 0 0 .658-.663 48.422 48.422 0 0 0-.37-5.36c-1.886.342-3.81.574-5.766.689a.578.578 0 0 1-.61-.58v0Z"}))}const $=r.forwardRef(_);function Z(){return e(p.Fragment,null,e(b,{className:"w-3 inline mr-1"}),"null")}function G(){return e(p.Fragment,null,e(D,{className:"w-3 inline mr-1"}),"true")}function U(){return e(p.Fragment,null,e(b,{className:"w-3 inline mr-1"}),"false")}function x({value:t}){return t===null?e(Z,null):typeof t=="string"||typeof t=="number"?t:typeof t=="boolean"?t?e(G,null):e(U,null):e(y,{settings:t})}const y=({settings:t})=>e("table",{className:"min-w-fit divide-y divide-gray-300"},e("tbody",{className:"divide-y divide-gray-200 bg-white"},Object.entries(t).map(([n,a])=>n=="@type"?e("tr",{key:n},e("td",{colSpan:2,className:"whitespace-nowrap py-2 px-4 text-sm font-medium font-mono text-xs text-gray-500 min-w-fit flex items-center",title:"This setting is a factory."},e(A,{className:" w-4 h-4 inline-block"}),e(x,{value:a}))):e("tr",{key:n},e("td",{className:"whitespace-nowrap py-2 px-4 text-sm font-medium text-gray-900 min-w-fit align-top"},n),e("td",{className:"whitespace-nowrap text-sm text-gray-500"},e(x,{value:a})))))),m={List:u(d.List)(()=>[{display:"flex","> :not([hidden]) ~ :not([hidden])":{"--tw-space-x-reverse":"0",marginRight:"calc(1rem * var(--tw-space-x-reverse))",marginLeft:"calc(1rem * calc(1 - var(--tw-space-x-reverse)))"},borderBottomWidth:"1px","--tw-border-opacity":"1",borderColor:"rgb(6 95 159 / var(--tw-border-opacity, 1))",paddingLeft:"1rem",paddingRight:"1rem"}]),InnerTab:u("span")(({selected:t=!1})=>[{display:"block"},{cursor:"pointer",fontSize:"1rem",lineHeight:"1.5rem",fontWeight:"500"},{borderTopLeftRadius:"0.125rem",borderTopRightRadius:"0.125rem",borderWidth:"1px",borderBottomWidth:"0px","--tw-border-opacity":"1",borderColor:"rgb(6 95 159 / var(--tw-border-opacity, 1))",paddingLeft:"0.75rem",paddingRight:"0.75rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},t?{"--tw-border-opacity":"1",borderColor:"rgb(6 95 159 / var(--tw-border-opacity, 1))","--tw-bg-opacity":"1",backgroundColor:"rgb(6 95 159 / var(--tw-bg-opacity, 1))","--tw-text-opacity":"1",color:"rgb(255 255 255 / var(--tw-text-opacity, 1))"}:{"--tw-text-opacity":"1",color:"rgb(6 95 159 / var(--tw-text-opacity, 1))"}]),Panels:u(d.Panels)(()=>[{maxWidth:"100%",borderWidth:"1px",borderTopWidth:"0px","--tw-border-opacity":"1",borderColor:"rgb(6 95 159 / var(--tw-border-opacity, 1))",padding:"1rem"}]),Panel:u(d.Panel)(()=>[{overflow:"auto"}])};function Y({children:t}){return e(d,{as:"button",className:"focus:ring-0 focus:ring-offset-0 focus:outline-none"},({selected:n})=>e(m.InnerTab,{selected:n},t))}const s=Object.assign(Y,{Group:d.Group,List:m.List,Panels:m.Panels,Panel:m.Panel}),J=()=>{const t=W();return e(s.Panel,null,e(g,{query:t},n=>e(l,{hasDefaultPadding:!1},e(y,{settings:n.data}))))};function K(){const t=E();return e(s.Panel,null,e(g,{query:t},n=>e(l,{hasDefaultPadding:!1},e(y,{settings:n.data}))))}function X(){const t=H();return e(s.Panel,null,e(g,{query:t},n=>e(l,{hasDefaultPadding:!1},e(y,{settings:n.data}))))}const ee=u.button`
  ${{display:"block",width:"100%",paddingLeft:"0.5rem",paddingRight:"0.5rem",paddingTop:"0.25rem",paddingBottom:"0.25rem",textAlign:"left","--tw-text-opacity":"1",color:"rgb(55 65 81 / var(--tw-text-opacity, 1))","&[data-focus]":{"--tw-bg-opacity":"1",backgroundColor:"rgb(243 244 246 / var(--tw-bg-opacity, 1))","--tw-text-opacity":"1",color:"rgb(17 24 39 / var(--tw-text-opacity, 1))"}}}
`;function te(t){return t>0?"up":t<0?"down":"checking"}function ne({endpointName:t,remoteEndpoint:n}){const a=z(),o=n.status??0,i=te(o);return e(C,{as:"div",className:"relative text-left"},e("div",{className:"flex"},e(L,{className:"inline-flex w-full justify-center rounded bg-white px-2 py-0.5 text-xs text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 capitalize items-center gap-x-1 mx-1"},i=="up"&&e("span",{title:"Remote endpoint is up and running"},e("svg",{viewBox:"0 0 6 6","aria-hidden":"true",className:"h-1.5 w-1.5 fill-green-500"},e("circle",{r:3,cx:3,cy:3}))),i=="checking"&&e("span",{title:"Remote endpoint is half-open, will recheck the remote status conservatively."},e("svg",{viewBox:"0 0 6 6","aria-hidden":"true",className:"h-1.5 w-1.5 fill-yellow-500"},e("circle",{r:3,cx:3,cy:3}))),i=="down"&&e("span",{title:"Remote endpoint is down, will not be used for routing."},e("svg",{viewBox:"0 0 6 6","aria-hidden":"true",className:"h-1.5 w-1.5 fill-red-500"},e("circle",{r:3,cx:3,cy:3}))),e("span",null,i),e(Q,{"aria-hidden":"true",className:"-mx-1 size-4 text-gray-400"}))),e(k,{transition:!0,className:"absolute text-xs left-0 z-10 mt-1 w-32 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 transition focus:outline-none data-[closed]:scale-95 data-[closed]:transform data-[closed]:opacity-0 data-[enter]:duration-100 data-[leave]:duration-75 data-[enter]:ease-out data-[leave]:ease-in"},e("div",{className:"py-1"},["up","checking","down"].map(c=>i!=c?e(T,{key:c},e(ee,{type:"button",onClick:()=>a.mutate({endpoint:t,url:n.settings.url,action:c})},"Set ",c)):null))))}function ae({endpointName:t,remote:n}){return n?e(l,{className:"flex flex-col divide-y divide-gray-200"},n.endpoints.map((a,o)=>e("div",{key:o,className:"flex items-center"},e("span",{className:"inline-flex items-center gap-x-1 px-2 py-0.5 text-sm font-medium text-gray-800"},n.current_pool.includes(a.settings.url)?e("span",{title:"Remote endpoint is active"},e("svg",{viewBox:"0 0 6 6","aria-hidden":"true",className:"h-1.5 w-1.5 fill-blue-500"},e("circle",{r:3,cx:3,cy:3}))):e("span",{title:"Remote endpoint is inactive"},e("svg",{viewBox:"0 0 6 6","aria-hidden":"true",className:"h-1.5 w-1.5 fill-stone-300"},e("circle",{r:3,cx:3,cy:3}))),e("a",{href:a.settings.url,className:"hover:underline",target:"_blank"},a.settings.url)),e(ne,{endpointName:t,remoteEndpoint:a}),a.failure_reasons?e("code",{className:"inline-flex font-mono text-xs"},a.failure_reasons.join(",")):null,(a.settings.pools||["default"]).map((i,c)=>e("span",{className:"inline-flex items-center gap-x-1 rounded-full px-2 py-0.5 text-xs font-medium text-gray-500 ring-1 ring-inset ring-gray-200 mx-1"},e(V,{key:c,className:"size-3"})," ",i))))):e(l,{className:"flex flex-col divide-y divide-gray-200"},"no remote")}function re({endpoints:t}){return e(p.Fragment,null,t.map((n,a)=>e(l,{className:"flex items-start",key:a},e("span",{className:"inline-flex items-center gap-x-1 px-2 py-0.5 text-sm font-medium text-gray-800"},e($,{className:"size-4"}),n.settings.name," (",n.settings.port,")"),e(ae,{endpointName:n.settings.name,remote:n.remote}))))}function oe(){const t=M();return e(g,{query:t},n=>e(s.Panel,null,e(l,null,e(R,null,"Topology"),e(re,{endpoints:n.data.endpoints}))))}const ye=()=>e(P,{title:e(S,{title:"System",description:"Informations about the running instance."})},e(N,null,e("title",null,"System | Harp"),e("meta",{name:"description",content:"System page"})),e(s.Group,null,e(s.List,{as:"nav","aria-label":"Tabs"},e(s,null,"Topology"),e(s,null,"Settings"),e(s,null,"Storage"),e(s,null,"Dependencies")),e(s.Panels,null,e(oe,null),e(K,null),e(X,null),e(J,null))));export{ye as default};
