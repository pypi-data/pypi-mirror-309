(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[863],{38127:function(e,t,s){Promise.resolve().then(s.bind(s,55274))},55274:function(e,t,s){"use strict";s.d(t,{Cl:function(){return D}});var a=s(57437),o=s(99376),l=s(2265),n=s(97082),r=s(38691);let i=e=>{let{getNodes:t,setNodes:s,getEdges:a,setEdges:o}=(0,n._K)(),i=(0,n.Bn)(),[c,d]=(0,l.useState)([]),[u,h]=(0,l.useState)([]),[m,p]=(0,l.useState)(),[x,g]=(0,l.useState)(),f=(0,r.o)(e=>e.setLoading),b=(0,r.o)(e=>e.showColumn),y=(0,r.o)(e=>e.setClearNodePosition),w=(0,r.o)(e=>e.leftMaxDepth),j=(0,r.o)(e=>e.rightMaxDepth),v=(0,l.useCallback)((e,t)=>{let s=new Map(e.map(e=>[e.id,e]));return t.forEach(e=>{if(s.has(e.id)){let t=s.get(e.id);"tableNode"==t.type&&s.set(e.id,{...t,data:{...t.data,...e.data,columns:Array.from(new Set([...t.data.columns,...e.data.columns]))}})}else s.set(e.id,e)}),Array.from(s.values())},[]),N=(0,l.useCallback)((e,t)=>{let s=new Map(e.map(e=>[e.id,e]));return t.forEach(e=>{s.has(e.id)||s.set(e.id,e)}),Array.from(s.values())},[]),C=(0,l.useCallback)(async(e,l,n)=>{f(!0);let r=JSON.stringify({[l]:[n]}),i=new URLSearchParams({sources:l,columns:r,depth:"1",show_column:b.toString(),reverse:"true"});j?i.set("depth","-1"):i.set("depth","1");let c=await fetch("".concat("","/api/v1/lineage?").concat(i)),u=await c.json();if(f(!1),200!=c.status){alert(u.error);return}if(0==u.edges.length){b?d(e=>[...e,n]):p(l);return}let h=v(t(),u.nodes),m=N(a(),u.edges);s(h),o(m),y(!0)},[t,a,b,j]),k=(0,l.useCallback)(async(e,l)=>{f(!0);let n=JSON.stringify({[e]:[l]}),r=new URLSearchParams({sources:e,columns:n,depth:"1",show_column:b.toString()});w?r.set("depth","-1"):r.set("depth","1");let i=await fetch("".concat("","/api/v1/lineage?").concat(r)),c=await i.json();if(f(!1),200!=i.status){alert(c.error);return}if(0==c.edges.length){b?h(e=>[...e,l]):g(e);return}let d=v(t(),c.nodes),u=N(a(),c.edges);s(d),o(u),y(!0)},[t,a,b,i,w]),L=(0,l.useCallback)(()=>{let t=[e];s(e=>e.filter(e=>!t.includes(e.id))),o(e=>e.filter(e=>!t.includes(e.source)&&!t.includes(e.target))),y(!0)},[e,s,o]),_=(0,l.useCallback)(e=>{let t={};return e.forEach(e=>{t[e.target]||(t[e.target]={}),e.targetHandle&&(t[e.target][e.targetHandle]=(t[e.target][e.targetHandle]||0)+1)}),Object.entries(t).filter(e=>{let[t,s]=e;return Object.values(s).some(e=>e>=2)}).map(e=>{let[t]=e;return t})},[]),S=(0,l.useCallback)((e,t)=>{let s=t.filter(t=>t.source===e).map(e=>e.target),a=_(t),o=s.filter(e=>!a.includes(e)),l=o.flatMap(e=>S(e,t));return[...o,...l]},[a]),P=(0,l.useCallback)((e,l)=>{let r=S(e,a()),i=[e,...r],c=new Map,d=new Set;a().forEach(t=>{if(t.fixed&&d.add(t.target),i.includes(t.source)&&i.includes(t.target)){var s,a;let o=c.get(t.source)||new Set,n=c.get(t.target)||new Set,r=(null===(s=t.sourceHandle)||void 0===s?void 0:s.split("__")[0])||"",i=(null===(a=t.targetHandle)||void 0===a?void 0:a.split("__")[0])||"",d=t.source===e&&r===l,u=o.has(r);(d||u)&&(n.add(i),c.set(t.target,n))}}),s(t=>t.map(e=>{if(!i.includes(e.id))return e;let t=c.get(e.id)||new Set,s=e.data.columns.filter(e=>!t.has(e));return{...e,data:{...e.data,columns:s}}}).filter(t=>t.id===e||t.data.columns.length>0||d.has(t.id))),o(s=>(0,n.my)(t(),s).filter(t=>{var s;return t.source!=e||(null===(s=t.sourceHandle)||void 0===s?void 0:s.split("__")[0])!=l})),y(!0)},[b,s,o,S,t,a]),R=(0,l.useCallback)(l=>{let r=S(l,a());s(e=>e.filter(e=>!r.includes(e.id))),o(s=>(0,n.my)(t(),s).filter(t=>t.source!=e&&!r.includes(t.source))),y(!0)},[S,t,a]);return{addReverseLineage:C,addSingleLineage:k,hideNode:L,getDescendantNodes:S,hideColumnAndRelatedEdges:P,hideTableAndRelatedEdges:R,lastNodeColumns:c,lastNodeTable:m,firstNodeColumns:u,firstNodeTable:x}};var c=s(51268),d=s(35217),u=(0,l.memo)(e=>{let{type:t,position:s,id:o,isConnectable:l,nodeId:i,onDelete:u,onConnect:h,showToggle:m=!0}=e,p=(0,n.oR)(e=>e.edges),x=(0,r.o)(e=>e.loading),g=p.some(e=>"target"===t&&e.target===i&&e.targetHandle===o||"source"===t&&e.source===i&&e.sourceHandle===o);return(0,a.jsxs)("div",{style:{position:"absolute",[s===n.Ly.Left?"left":"right"]:"-2px",top:"50%",transform:"translateY(-50%)",zIndex:1},children:[(0,a.jsx)(n.HH,{type:t,position:s,id:o,isConnectable:l,style:{opacity:0,width:"24px",height:"24px",background:"transparent",border:"none"}}),m&&(0,a.jsx)("button",{className:"w-6 h-6 flex items-center justify-center bg-white rounded-full border border-gray-300 hover:bg-gray-100 focus:outline-none",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",pointerEvents:"auto",cursor:"source"===t&&g?"pointer":"default"},onClick:e=>{x||(e.stopPropagation(),"source"===t&&g?u():g||h(t))},children:"source"===t&&g?(0,a.jsx)(c.G,{icon:d.Kl4,className:"text-gray-600"}):g?(0,a.jsx)("span",{className:"w-4 h-4"}):(0,a.jsx)(c.G,{icon:x?d.LM3:d.r8p,spinPulse:x,className:"text-gray-600"})})]})}),h=s(83986),m=s(93448),p=(0,l.memo)(e=>{let{schema:t,tableName:s,selected:n,materialized:i,isClickableTableName:u,content:p,hideNode:x}=e,g=(0,r.o)(e=>e.setMessage),f=(0,o.useSearchParams)(),[b,y]=(0,l.useState)(!1),w=(0,l.useCallback)(e=>{e.stopPropagation();let a=new URLSearchParams({schema:t,sources:s,activeSource:s});window.open("/cte?".concat(a.toString()),"_blank")},[t,s]),j=(0,l.useCallback)(async e=>{e.stopPropagation();try{await navigator.clipboard.writeText(s),g("Copied to clipboard!","success"),setTimeout(()=>g(null,null),3e3)}catch(e){console.error("Failed to copy text: ",e)}},[s]),v=(0,l.useCallback)(e=>{e.stopPropagation(),x()},[x]),N=(0,l.useCallback)(()=>f.get("source")!==s,[f,s]),C=(0,m.C)(i);return(0,a.jsxs)("div",{className:"flex flex-col bg-white transition-all duration-250 ease-in-out border-0 border-solid border-gray-300 text-sm \n      ".concat(n?"shadow-lg":"shadow-md"),children:[(0,a.jsxs)("div",{className:"relative py-2 px-3 flex items-center justify-between ".concat(C),children:[(0,a.jsx)("div",{className:"flex-grow mr-2 overflow-hidden text-ellipsis",children:u?(0,a.jsx)("span",{className:"cursor-pointer hover:underline",onClick:w,title:s,children:s}):(0,a.jsx)("span",{title:s,children:s})}),(0,a.jsxs)("div",{className:"flex-shrink-0 flex items-center",children:[(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("button",{className:"p-1 rounded-full hover:bg-gray-200 focus:outline-none",onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),children:(0,a.jsx)(c.G,{icon:d.iV1})}),b&&(0,a.jsx)("div",{className:"absolute right-0 top-0 bg-white rounded-md shadow-lg z-10 whitespace-nowrap",style:{transform:"translate(5%, -90%)"},onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),children:(0,a.jsx)("div",{className:"py-1",children:(0,a.jsxs)("button",{onClick:j,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",title:"Copy table name",children:[(0,a.jsx)(c.G,{icon:h.kZ_,className:"mr-2"}),"Copy table name"]})})})]}),N()&&(0,a.jsx)("button",{onClick:v,className:"p-1 ml-2 rounded-full hover:bg-gray-200 focus:outline-none",title:"Hide node",children:(0,a.jsx)(c.G,{icon:d.NBC})})]})]}),(0,a.jsx)("div",{className:"",children:p})]})}),x=(0,l.memo)(e=>{let{schema:t,tableName:s,nodeColumns:o,handlePlusClickEventNodeHandle:n}=e,[r,i]=(0,l.useState)(!1),[u,h]=(0,l.useState)(!1),[m,p]=(0,l.useState)([]),[x,g]=(0,l.useState)(null),f=(0,l.useRef)(null),b=(0,l.useRef)(null),y=(0,l.useCallback)(async()=>{if(!(m.length>0)&&!r){i(!0);try{let e=new URLSearchParams({schema:t,source:s}),a=await fetch("".concat("","/api/v1/columns?").concat(e)),l=await a.json(),n=new Set(o.map(e=>e.toLowerCase())),r=l.filter(e=>!n.has(e.value.toLowerCase()));p(r)}catch(e){console.error("Error fetching columns:",e)}finally{i(!1)}}},[t,s,o,r,i]),w=(0,l.useCallback)(()=>{h(e=>{let t=!e;return t&&y(),t})},[y]),j=(0,l.useCallback)(async e=>{!r&&(await n(e.value,"source"),p(t=>t.filter(t=>t.value!==e.value)),b.current&&g(b.current.offsetWidth))},[r,n]);return(0,l.useEffect)(()=>{b.current&&g(b.current.offsetWidth)},[]),(0,a.jsxs)("div",{ref:b,children:[(0,a.jsx)("div",{className:"mt-2 border-t pt-2 flex justify-center",children:(0,a.jsx)("button",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-gray-200 hover:bg-gray-300 focus:outline-none",onClick:w,"aria-label":u?"Collapse columns":"Expand columns",children:(0,a.jsx)(c.G,{icon:u?d.mTx:d.ptq,className:"text-gray-600"})})}),u&&x&&(0,a.jsx)("div",{ref:f,className:"nowheel mt-2 max-h-60 overflow-y-auto pr-4 scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200",style:{width:"".concat(x,"px"),overflow:"auto"},onWheel:e=>e.stopPropagation(),children:r?(0,a.jsx)("p",{className:"text-center",children:"Loading columns..."}):m.length>0?(0,a.jsx)("ul",{className:"list-none p-0 m-0",children:m.map(e=>(0,a.jsxs)("li",{className:"flex flex-col relative cursor-pointer hover:bg-gray-100 transition-colors duration-200 py-2 px-6",onClick:()=>j(e),children:[(0,a.jsx)("span",{className:"hover:underline flex-grow truncate",children:e.label}),e.description&&(0,a.jsx)("span",{className:"text-xs text-gray-500 mt-1 truncate",title:e.description,children:e.description})]},e.value))}):(0,a.jsx)("p",{className:"text-center text-gray-500",children:"All columns have been selected."})})]})}),g=(0,l.memo)(e=>{let{type:t,position:s,id:o,isConnectable:l,nodeId:i,onConnect:u,onDelete:h}=e,m=(0,n.oR)(e=>e.edges),p=(0,r.o)(e=>e.loading),x=m.some(e=>"target"===t&&e.target===i&&e.targetHandle===o||"source"===t&&e.source===i&&e.sourceHandle===o),g={position:"absolute",top:"22px",transform:"translateY(-50%)",...s===n.Ly.Left?{left:"-2px"}:{right:"-2px"},zIndex:1};return(0,a.jsxs)("div",{style:g,children:[(0,a.jsx)(n.HH,{type:t,position:s,id:o,isConnectable:l,style:{opacity:0,width:"24px",height:"24px",background:"transparent",border:"none"}}),h&&(0,a.jsx)("button",{className:"w-6 h-6 flex items-center justify-center bg-white rounded-full border border-gray-300 hover:bg-gray-100 focus:outline-none",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",pointerEvents:"auto",cursor:"source"===t&&x?"pointer":"default"},onClick:e=>{p||(e.stopPropagation(),"source"===t&&x&&h?h():!x&&u&&u())},children:"source"===t&&x&&h?(0,a.jsx)(c.G,{icon:d.Kl4,className:"text-gray-600"}):!x&&u?(0,a.jsx)(c.G,{icon:p?d.LM3:d.r8p,spinPulse:p,className:"text-gray-600"}):(0,a.jsx)("span",{className:"w-4 h-4"})})]})});let f=e=>{let{data:t,id:s,selected:o}=e,{addSingleLineage:c,addReverseLineage:d,hideNode:h,hideTableAndRelatedEdges:m,hideColumnAndRelatedEdges:f,lastNodeColumns:b,lastNodeTable:y,firstNodeColumns:w,firstNodeTable:j}=i(s),v=(0,r.o)(e=>e.options),N=(0,r.o)(e=>e.showColumn),C=(0,l.useCallback)((e,s)=>{e.stopPropagation();let{schema:a,name:o}=t,l=JSON.stringify({[o]:[s.toLowerCase()]}),n=new URLSearchParams({schema:a,sources:o,activeSource:o,selectedColumns:l});window.open("/cte?".concat(n.toString()),"_blank")},[t]),k=(0,l.useCallback)(async(e,a)=>{"target"===a?await d(s,t.name,e):"source"===a&&await c(t.name,e)},[d,c,s,t.name]),L=(0,l.useCallback)(e=>{N?f(s,e):m(s)},[N,f,m,s]);return N?(0,a.jsx)(p,{schema:t.schema,tableName:t.name,selected:o,hideNode:h,isClickableTableName:!1,materialized:t.materialized,content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[j!=t.name&&(0,a.jsx)(g,{type:"source",position:n.Ly.Left,id:"".concat(s,"__source"),isConnectable:!0,nodeId:s}),y!=t.name&&(0,a.jsx)(g,{type:"target",position:n.Ly.Right,id:"".concat(s,"__target"),isConnectable:!0,nodeId:s})]}),(0,a.jsxs)("div",{className:"py-2 px-0",children:[t.columns.map(e=>(0,a.jsxs)("div",{className:"flex items-center relative",style:{position:"relative",padding:"8px 16px",flexGrow:1,textAlign:"left",paddingRight:"24px",paddingLeft:"24px"},children:[(0,a.jsx)("p",{className:"cursor-pointer hover:underline flex-grow",onClick:t=>C(t,e),children:e}),!t.last&&!w.includes(e)&&(0,a.jsx)(u,{type:"source",position:"LR"===v.rankdir?n.Ly.Right:n.Ly.Left,id:"".concat(e,"__source"),isConnectable:!0,nodeId:s,onDelete:()=>L(e),onConnect:()=>k(e,"source")}),!t.first&&!b.includes(e)&&(0,a.jsx)(u,{type:"target",position:"LR"===v.rankdir?n.Ly.Left:n.Ly.Right,id:"".concat(e,"__target"),isConnectable:!0,nodeId:s,onDelete:()=>L(e),onConnect:()=>k(e,"target")})]},"i-"+e)),(0,a.jsx)(x,{schema:t.schema,tableName:t.name,nodeColumns:t.columns,handlePlusClickEventNodeHandle:k})]})]})}):(0,a.jsx)(p,{schema:t.schema,tableName:t.name,selected:o,hideNode:h,isClickableTableName:!0,materialized:t.materialized,content:(0,a.jsxs)(a.Fragment,{children:[j!=t.name&&(0,a.jsx)(g,{type:"source",position:n.Ly.Left,id:"".concat(s,"__source"),isConnectable:!0,nodeId:s,onConnect:()=>k("","source"),onDelete:L}),y!=t.name&&(0,a.jsx)(g,{type:"target",position:n.Ly.Right,id:"".concat(s,"__target"),isConnectable:!0,nodeId:s,onConnect:()=>k("","target"),onDelete:L})]})})};var b=s(96627),y=s(26554),w=s(54281);s(36556);var j=s(34161),v=s.n(j);let N=(e,t,s)=>{let a=new(v()).graphlib.Graph;return a.setDefaultEdgeLabel(()=>({})),a.setGraph(s),t.forEach(e=>a.setEdge(e.source,e.target)),e.forEach(e=>a.setNode(e.id,{label:e.id,width:e.width,height:e.height})),v().layout(a),e.forEach(e=>{let t=a.node(e.id);switch(s.rankdir){case"TB":e.targetPosition=n.Ly.Top,e.sourcePosition=n.Ly.Bottom;break;case"BT":e.targetPosition=n.Ly.Bottom,e.sourcePosition=n.Ly.Top;break;case"LR":e.targetPosition=n.Ly.Left,e.sourcePosition=n.Ly.Right;break;case"RL":e.targetPosition=n.Ly.Right,e.sourcePosition=n.Ly.Left}return e.position={x:t.x-t.width/2+Math.random()/1e3,y:t.y-t.height/2},e}),{nodes:e,edges:t}},C=e=>{let{setNodes:t,setEdges:s,setViewIsFit:i,nodesPositioned:u,setNodesPositioned:h}=e,{fitView:m}=(0,n._K)(),p=(0,n.oR)(e=>e.nodeInternals),x=Array.from(p.values()),g=(0,n.oR)(e=>e.edges),f=(0,n.oR)(e=>e.transform),b=(0,r.o)(e=>e.options),y=(0,r.o)(e=>e.sidebarActive),w=(0,r.o)(e=>e.setSidebarActive),j=(0,o.useRouter)();return(0,l.useCallback)((e,t)=>{let s=new URLSearchParams({schema:e.data.schema,source:e.data.name,column:t});j.push("/cte?".concat(s.toString()))},[p]),(0,l.useEffect)(()=>{try{var e;if((null===(e=x[0])||void 0===e?void 0:e.width)&&x.length>0&&!u){let e=N(x,g,b);console.log("redraw",e),t(e.nodes),s(e.edges),h(!0),window.requestAnimationFrame(()=>{setTimeout(()=>m(),0)}),i(!0)}}catch(e){console.log("error",e)}},[u,x]),(0,a.jsxs)("div",{className:"bg-white drop-shadow-md "+(y?"w-1/6":"w-5"),children:[(0,a.jsx)("div",{className:"px-1",onClick:()=>w(!y),children:(0,a.jsx)(c.G,{icon:y?d.yOZ:d.EyR,className:"h-[20px]"})}),y&&(0,a.jsxs)("div",{className:"px-2 text-sm",children:[(0,a.jsx)("div",{className:"py-1 font-semibold text-base",children:"Zoom & pan transform"}),(0,a.jsxs)("div",{className:"transform break-words",children:["[",f[0].toFixed(2),", ",f[1].toFixed(2),", ",f[2].toFixed(2),"]"]}),(0,a.jsx)("div",{className:"py-1 font-semibold text-base",children:"Nodes"}),x.map(e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium break-words",children:e.data.name}),(0,a.jsxs)("div",{children:["x: ",e.position.x.toFixed(2),", y: ",e.position.y.toFixed(2)]})]},e.id))]})]})};var k=s(9965),L=s(73732),_=s(82029),S=s(33003),P=s(53581),R=()=>{let{getEdges:e,setEdges:t}=(0,n._K)(),{fitView:s}=(0,n._K)(),o=(0,r.o)(e=>e.showColumn),i=(0,r.o)(e=>e.setShowColumn),c=(0,r.o)(e=>e.setClearNodePosition),d=(0,r.o)(e=>e.columnModeEdges),u=(0,r.o)(e=>e.setColumnModeEdges),h=(0,r.o)(e=>e.setRightMaxDepth),m=(0,r.o)(e=>e.setMessage),[p,x]=(0,l.useState)("column"),g=[{id:"table",icon:_.Z,label:"Table"},{id:"column",icon:S.Z,label:"Column"}];(0,l.useEffect)(()=>{x(o?"column":"table")},[o]);let f=(0,l.useCallback)(s=>{let a="column"===s;i(a);let o=e().filter(e=>(null==e?void 0:e.mode)!="dashboard"),l=e().filter(e=>(null==e?void 0:e.mode)=="dashboard");if(a){let e=o.map(e=>({...e,fixed:!0,style:{...e.style,strokeDasharray:"5,5",strokeWidth:1.5}}));t(d.concat(e).concat(l)),h(!1)}else{u(o.filter(e=>!e.fixed));let e=new Map;o.forEach(t=>{let s=t.source,a=t.target,o="".concat(s,"-").concat(a);e.has(o)||e.set(o,{id:o,source:s,target:a,sourceHandle:"".concat(s,"__source"),targetHandle:"".concat(a,"__target")})}),t(Array.from(e.values()).concat(l))}c(!0)},[e,t,i,c,d]),b=(0,l.useCallback)(async()=>{let e=document.querySelector(".react-flow__viewport");window.requestAnimationFrame(()=>s()),await new Promise(e=>setTimeout(e,100));let t=await (0,L.SE)(e,{backgroundColor:"#fff"});if(t)try{let e=[new window.ClipboardItem({"image/png":t})];await navigator.clipboard.write(e);let s=new URLSearchParams(window.location.search).toString();m("Successfully copied to clipboard!:\n\n"+s,"success"),setTimeout(()=>m(null,null),6e3)}catch(e){m("Failed to copy to clipboard","error"),console.error("Failed to copy:",e),setTimeout(()=>m(null,null),3e3)}},[]);return(0,a.jsx)("div",{className:"flex flex-col space-y-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"inline-flex rounded-md shadow-sm",role:"group",children:g.map(e=>(0,a.jsxs)("button",{type:"button",className:"px-4 py-2 text-sm font-medium border flex items-center whitespace-nowrap ".concat(p===e.id?"bg-blue-500 text-white border-blue-600":"bg-white text-gray-700 border-gray-200 hover:bg-gray-50"," ").concat(e.id===g[0].id?"rounded-l-lg":e.id===g[g.length-1].id?"rounded-r-lg":""),onClick:()=>f(e.id),children:[(0,a.jsx)(e.icon,{className:"mr-2",size:16}),(0,a.jsx)("span",{children:e.label})]},e.id))}),(0,a.jsxs)("button",{onClick:b,className:"rounded px-4 py-2 text-sm font-medium border bg-blue-500 text-white border-blue-600 flex items-center hover:bg-blue-600 transition-colors duration-200","aria-label":"Copy to clipboard",children:[(0,a.jsx)(P.Z,{className:"mr-2",size:16}),(0,a.jsx)("span",{children:"Copy to clipboard"})]})]})})},E=(0,l.memo)(e=>{let{name:t,url:s,selected:n,content:i,hideNode:u}=e;(0,r.o)(e=>e.setMessage);let h=(0,o.useSearchParams)(),[p,x]=(0,l.useState)(!1),g=(0,l.useCallback)(e=>{e.stopPropagation(),window.open(s,"_blank")},[s]),f=(0,l.useCallback)(e=>{e.stopPropagation(),u()},[u]),b=(0,l.useCallback)(()=>h.get("source")!==t,[h,t]),y=(0,m.C)("dashboard");return(0,a.jsxs)("div",{className:"flex flex-col bg-white transition-all duration-250 ease-in-out border-0 border-solid border-gray-300 text-sm \n      ".concat(n?"shadow-lg":"shadow-md"),children:[(0,a.jsxs)("div",{className:"relative py-2 px-3 flex items-center justify-between ".concat(y),children:[(0,a.jsx)("div",{className:"flex-grow mr-2 overflow-hidden text-ellipsis",children:(0,a.jsx)("span",{className:"cursor-pointer hover:underline",onClick:g,title:t,children:t})}),(0,a.jsx)("div",{className:"flex-shrink-0 flex items-center",children:b()&&(0,a.jsx)("button",{onClick:f,className:"p-1 ml-2 rounded-full hover:bg-gray-200 focus:outline-none",title:"Hide node",children:(0,a.jsx)(c.G,{icon:d.NBC})})})]}),(0,a.jsx)("div",{className:"",children:i})]})});let M=e=>{let{data:t,id:s,selected:o}=e,{hideNode:c}=i(s),d=(0,r.o)(e=>e.options),h=(0,l.useCallback)((e,t)=>{e.stopPropagation(),window.open(t,"_blank")},[t]);return(0,a.jsx)(E,{id:t.id,name:t.name,url:t.url,selected:o,hideNode:c,content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{children:(0,a.jsx)(g,{type:"source",position:n.Ly.Left,id:"".concat(s,"__source"),isConnectable:!0,nodeId:s})}),(0,a.jsx)("div",{className:"py-2 px-0",children:t.elements.map(e=>(0,a.jsxs)("div",{className:"flex items-center relative",style:{position:"relative",padding:"8px 16px",flexGrow:1,textAlign:"left",paddingRight:"24px",paddingLeft:"24px"},children:[(0,a.jsx)("p",{className:"cursor-pointer hover:underline flex-grow",onClick:t=>h(t,e.explore_url),children:e.title}),(0,a.jsx)(u,{type:"source",position:"LR"===d.rankdir?n.Ly.Right:n.Ly.Left,id:"".concat(e.id,"__source"),isConnectable:!0,nodeId:s,showToggle:!1,onDelete:()=>null,onConnect:()=>null})]},"i-"+e.id))})]})})},D=()=>{let{height:e,width:t}=(0,b.Y)(),[s,i]=(0,n.Rr)([]),[c,d]=(0,n.ll)([]),[u,h]=(0,l.useState)(!1),[p,x]=(0,l.useState)(!0),g=(0,r.o)(e=>e.setMessage),j=(0,r.o)(e=>e.sidebarActive);(0,r.o)(e=>e.options);let v=(0,r.o)(e=>e.setOptions),N=(0,r.o)(e=>e.clearNodePosition),L=(0,r.o)(e=>e.setClearNodePosition),_=(0,r.o)(e=>e.leftMaxDepth),S=(0,r.o)(e=>e.setLeftMaxDepth),P=(0,r.o)(e=>e.rightMaxDepth),E=(0,r.o)(e=>e.setRightMaxDepth),D=(0,r.o)(e=>e.showColumn),H=(0,r.o)(e=>e.setShowColumn),F=(0,o.useSearchParams)(),T=(0,l.useCallback)(async e=>{let t,{dashboardId:s,sources:a,columns:o,showColumn:l,depth:n}=e;if(i([]),d([]),H(!!l),s){let e=new URLSearchParams({dashboard_id:s,depth:"1"});t=await fetch("".concat("","/api/v1/dashboard_lineage?").concat(e))}else{let e=new URLSearchParams({sources:a.join(","),columns:JSON.stringify(o),show_column:l.toString()});Number.isNaN(n)?l?e.append("depth","-1"):e.append("depth","1"):e.set("depth",n.toString()),t=await fetch("".concat("","/api/v1/lineage?").concat(e))}let r=await t.json();return 200!=t.status?(g(r.detail,"error"),setTimeout(()=>g(null,null),3e3),!1):(i(r.nodes),d(r.edges),x(!1),!0)},[F]),A=(0,l.useCallback)(e=>i(t=>(0,n.Fb)(e,t)),[i]),G=(0,l.useCallback)(e=>d(t=>(0,n.yn)(e,t)),[d]),I=(0,l.useCallback)(e=>d(t=>(0,n.Z_)(e,t)),[d]),O=(0,l.useMemo)(()=>({tableNode:e=>(0,a.jsx)(f,{...e}),dashboardNode:e=>(0,a.jsx)(M,{...e})}),[]);return(0,l.useEffect)(()=>{N&&(L(!1),setTimeout(()=>x(!1),100))},[N]),(0,l.useEffect)(()=>{x(!1)},[j]),(0,l.useEffect)(()=>{v({rankdir:"RL"})},[]),(0,a.jsxs)("div",{children:[(0,a.jsx)(k.h,{handleFetchData:T}),(0,a.jsx)("div",{className:"flex flex-wrap",children:(0,a.jsxs)(n.tV,{children:[(0,a.jsx)("div",{className:j?"w-5/6":"w-[calc(100%-20px)]",style:{height:e-55},children:(0,a.jsxs)(n.x$,{minZoom:.2,nodes:s,edges:c,onNodesChange:A,onEdgesChange:G,onConnect:I,nodeTypes:O,children:[(0,a.jsx)(n.s_,{position:"top-left",children:(0,a.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,a.jsx)(R,{}),(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{id:"leftMaxDepth",type:"checkbox",checked:_,onChange:()=>S(!_),className:"form-checkbox h-4 w-4 text-blue-600 rounded"}),(0,a.jsx)("label",{htmlFor:"leftMaxDepth",className:"ml-2 text-sm text-gray-700",children:"Max depth for left (+) button"})]}),!D&&(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{id:"rightMaxDepth",type:"checkbox",checked:P,onChange:()=>E(!P),className:"form-checkbox h-4 w-4 text-blue-600 rounded"}),(0,a.jsx)("label",{htmlFor:"rightMaxDepth",className:"ml-2 text-sm text-gray-700",children:"Max depth for right (+) button"})]})]})]})}),(0,a.jsx)(n.s_,{position:"top-right",children:s.length>0&&(0,a.jsx)("div",{className:"p-1 rounded",children:(0,a.jsx)("div",{className:"flex items-center space-x-2",children:m.p.map(e=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-4 h-4 mr-1 rounded-sm ".concat((0,m.C)(e))}),(0,a.jsx)("span",{className:"text-[10px] whitespace-nowrap text-gray-700",children:e})]},e))})})}),(0,a.jsx)(y.Z,{}),(0,a.jsx)(w.A,{style:{backgroundColor:"#f5f5f5"}})]})}),(0,a.jsx)(C,{setNodes:i,setEdges:d,setViewIsFit:h,setNodesPositioned:x,nodesPositioned:p})]})})]})}}},function(e){e.O(0,[627,780,676,563,848,496,971,117,744],function(){return e(e.s=38127)}),_N_E=e.O()}]);