(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[417],{18513:(e,s,t)=>{Promise.resolve().then(t.bind(t,19638))},19638:(e,s,t)=>{"use strict";t.d(s,{DatasetViewer:()=>O});var a=t(57437),o=t(89669),n=t(50495),l=t(46910),r=t(92694),i=t(35657),d=t(37440),c=t(34446),m=t(22023),p=t(44378),u=t(3274),h=t(2265);h.forwardRef((e,s)=>{let{className:t,...o}=e;return(0,a.jsx)("div",{ref:s,className:(0,d.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...o})}).displayName="Card",h.forwardRef((e,s)=>{let{className:t,...o}=e;return(0,a.jsx)("div",{ref:s,className:(0,d.cn)("flex flex-col space-y-1.5 p-6",t),...o})}).displayName="CardHeader",h.forwardRef((e,s)=>{let{className:t,...o}=e;return(0,a.jsx)("div",{ref:s,className:(0,d.cn)("text-2xl font-semibold leading-none tracking-tight",t),...o})}).displayName="CardTitle",h.forwardRef((e,s)=>{let{className:t,...o}=e;return(0,a.jsx)("div",{ref:s,className:(0,d.cn)("text-sm text-muted-foreground",t),...o})}).displayName="CardDescription";let x=h.forwardRef((e,s)=>{let{className:t,...o}=e;return(0,a.jsx)("div",{ref:s,className:(0,d.cn)("p-6 pt-0",t),...o})});x.displayName="CardContent",h.forwardRef((e,s)=>{let{className:t,...o}=e;return(0,a.jsx)("div",{ref:s,className:(0,d.cn)("flex items-center p-6 pt-0",t),...o})}).displayName="CardFooter";var f=t(48484);let g=h.forwardRef((e,s)=>{let{className:t,orientation:o="horizontal",decorative:n=!0,...l}=e;return(0,a.jsx)(f.f,{ref:s,decorative:n,orientation:o,className:(0,d.cn)("shrink-0 bg-border","horizontal"===o?"h-[1px] w-full":"h-full w-[1px]",t),...l})});g.displayName=f.f.displayName;var v=t(6884),j=t(13304),N=t(12218),b=t(74697);let w=j.fC;j.xz,j.x8;let y=j.h_,k=h.forwardRef((e,s)=>{let{className:t,...o}=e;return(0,a.jsx)(j.aV,{className:(0,d.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...o,ref:s})});k.displayName=j.aV.displayName;let _=(0,N.j)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),C=h.forwardRef((e,s)=>{let{side:t="right",className:o,children:n,...l}=e;return(0,a.jsxs)(y,{children:[(0,a.jsx)(k,{}),(0,a.jsxs)(j.VY,{ref:s,className:(0,d.cn)(_({side:t}),o),...l,children:[(0,a.jsx)(M,{className:"sr-only",children:"Menu"}),n,(0,a.jsxs)(j.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,a.jsx)(b.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});C.displayName=j.VY.displayName;let M=h.forwardRef((e,s)=>{let{className:t,...o}=e;return(0,a.jsx)(j.Dx,{ref:s,className:(0,d.cn)("text-lg font-semibold text-foreground",t),...o})});function S(e){var s,t,o,l,r,i,d,c,m,p,u,f,j;let{item:N,onClose:b}=e,y=(0,h.useCallback)(async e=>{try{await navigator.clipboard.writeText(e),alert("Copied to clipboard!")}catch(e){console.error("Failed to copy:",e),alert("Failed to copy to clipboard")}},[]);return N?(0,a.jsx)(w,{open:!!N,onOpenChange:()=>N&&b(),children:(0,a.jsx)(C,{side:"right",className:"w-full sm:w-[540px] p-0 fixed inset-y-0 border-l",style:{height:"100vh"},children:(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsx)("div",{className:"p-6 border-b flex items-center justify-between",children:(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Response Details"})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsxs)(x,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Model"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:N.generic_request.model})]}),(0,a.jsx)(g,{}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"User Message"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:null===(s=N.generic_request.messages.find(e=>"user"===e.role))||void 0===s?void 0:s.content}),(0,a.jsxs)(n.z,{onClick:()=>{var e;return y((null===(e=N.generic_request.messages.find(e=>"user"===e.role))||void 0===e?void 0:e.content)||"")},variant:"outline",size:"sm",className:"mt-2",children:[(0,a.jsx)(v.Z,{className:"h-4 w-4 mr-2"}),"Copy"]})]}),(0,a.jsx)(g,{}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Assistant Message"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:"object"==typeof N.response_message?JSON.stringify(N.response_message,null,2):N.response_message}),(0,a.jsxs)(n.z,{onClick:()=>y("object"==typeof N.response_message?JSON.stringify(N.response_message,null,2):N.response_message||""),variant:"outline",size:"sm",className:"mt-2",children:[(0,a.jsx)(v.Z,{className:"h-4 w-4 mr-2"}),"Copy"]})]}),(0,a.jsx)(g,{}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Token Usage"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Total"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:(null===(t=N.raw_response.usage)||void 0===t?void 0:t.total_tokens)||(null===(r=N.raw_response.response)||void 0===r?void 0:null===(l=r.body)||void 0===l?void 0:null===(o=l.usage)||void 0===o?void 0:o.total_tokens)})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Prompt"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:(null===(i=N.raw_response.usage)||void 0===i?void 0:i.prompt_tokens)||(null===(m=N.raw_response.response)||void 0===m?void 0:null===(c=m.body)||void 0===c?void 0:null===(d=c.usage)||void 0===d?void 0:d.prompt_tokens)})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Completion"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:(null===(p=N.raw_response.usage)||void 0===p?void 0:p.completion_tokens)||(null===(j=N.raw_response.response)||void 0===j?void 0:null===(f=j.body)||void 0===f?void 0:null===(u=f.usage)||void 0===u?void 0:u.completion_tokens)})]})]})]})]})})]})})}):null}M.displayName=j.Dx.displayName,h.forwardRef((e,s)=>{let{className:t,...o}=e;return(0,a.jsx)(j.dk,{ref:s,className:(0,d.cn)("text-sm text-muted-foreground",t),...o})}).displayName=j.dk.displayName;var T=t(35231),R=t(41672),E=t(2842),F=t(9542),P=t(85475),z=t(13971);let L={total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens"};function D(e){let{data:s,column:t}=e,o=function(e,s){let t=e.map(e=>{var t,a,o,n,l,r,i,d,c,m,p,u;switch(s){case"total_tokens":return(null===(t=e.raw_response.usage)||void 0===t?void 0:t.total_tokens)||(null===(n=e.raw_response.response)||void 0===n?void 0:null===(o=n.body)||void 0===o?void 0:null===(a=o.usage)||void 0===a?void 0:a.total_tokens)||0;case"prompt_tokens":return(null===(l=e.raw_response.usage)||void 0===l?void 0:l.prompt_tokens)||(null===(d=e.raw_response.response)||void 0===d?void 0:null===(i=d.body)||void 0===i?void 0:null===(r=i.usage)||void 0===r?void 0:r.prompt_tokens)||0;case"completion_tokens":return(null===(c=e.raw_response.usage)||void 0===c?void 0:c.completion_tokens)||(null===(u=e.raw_response.response)||void 0===u?void 0:null===(p=u.body)||void 0===p?void 0:null===(m=p.usage)||void 0===m?void 0:m.completion_tokens)||0;default:return 0}}),a=Math.min(...t),o=Math.max(...t);if(a===o)return[{range:"".concat(a),count:t.length}];let{binSize:n,start:l,end:r}=function(e,s){let t=s-e,a=Math.pow(10,Math.floor(Math.log10(t))),o=[.1*a,.2*a,.5*a,a,2*a,5*a,10*a].reduce((e,s)=>Math.abs(t/s-7)<Math.abs(t/e-7)?s:e),n=Math.floor(e/o)*o,l=Math.ceil(s/o)*o;return{binSize:o,start:n,end:l}}(a,o),i=Math.ceil((r-l)/n),d=[];for(let e=0;e<i;e++){let s=l+e*n,t=s+n;d.push({range:"".concat(Math.round(s),"-").concat(Math.round(t)),start:s,count:0})}return t.forEach(e=>{let s=Math.floor((e-l)/n);s>=0&&s<d.length&&d[s].count++}),d.filter(e=>e.count>0).sort((e,s)=>e.start-s.start).map(e=>{let{range:s,count:t}=e;return{range:s,count:t}})}(s,t);if(0===o.length)return null;let n=L[t]||t;return(0,a.jsxs)("div",{className:"w-full h-80",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold mb-4",children:["Distribution of ",n]}),(0,a.jsx)(T.h,{width:"100%",height:"100%",children:(0,a.jsxs)(R.v,{data:o,margin:{top:10,right:30,left:20,bottom:15},children:[(0,a.jsx)(E.K,{dataKey:"range",fontSize:12,angle:-45,textAnchor:"end",height:70}),(0,a.jsx)(F.B,{}),(0,a.jsx)(P.u,{formatter:e=>["Count: ".concat(e),n]}),(0,a.jsx)(z.$,{dataKey:"count",fill:"#8884d8",name:n})]})})]})}let A=[{key:"user_message",label:"User Message"},{key:"assistant_message",label:"Assistant Message"},{key:"prompt_tokens",label:"Prompt Tokens"},{key:"completion_tokens",label:"Completion Tokens"}];function V(e){let{batchMode:s,isPolling:t}=e;return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-[60vh] p-8",children:[(0,a.jsx)("div",{className:"bg-muted/30 rounded-full p-6 mb-6",children:(0,a.jsx)(m.Z,{className:"w-12 h-12 text-muted-foreground"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"No responses available yet"}),(0,a.jsx)("p",{className:"text-muted-foreground text-center max-w-md mb-4",children:s?"Waiting for the first batch to complete. Once finished, responses will appear here in batches.":"Responses will appear here as they are generated. The table will update automatically. Check if the curator is still running."}),(0,a.jsx)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.Z,{className:"w-4 h-4 animate-spin"}),(0,a.jsx)("span",{children:"Polling for new responses..."})]}):(0,a.jsx)("span",{children:"Polling is paused"})})]})}function O(e){let{runHash:s,batchMode:t}=e,[m,p]=(0,h.useState)([]),[x,f]=(0,h.useState)("light"),[g,v]=(0,h.useState)(!1),[j,N]=(0,h.useState)("total_tokens"),[b,w]=(0,h.useState)(null),{toast:y}=(0,i.pm)(),[k,_]=(0,h.useState)(!1),[C,M]=(0,h.useState)(0),[T,R]=(0,h.useState)(!0),[E,F]=(0,h.useState)(new Set),[P,z]=(0,h.useState)([]);(0,h.useEffect)(()=>{let e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";f(localStorage.getItem("theme")||e),v(!0)},[]),(0,h.useEffect)(()=>{g&&("dark"===x?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("theme",x))},[x,g]);let L=(0,h.useCallback)(async()=>{if(s)try{let e=new URLSearchParams({batchMode:t.toString(),...t?{processedFiles:P.join(",")}:{lastLine:C.toString()}}),a=await fetch("/api/responses/".concat(s,"?").concat(e));if(!a.ok)throw Error("Failed to fetch responses");let o=await a.json();o.data&&o.data.length>0&&(F(new Set(o.data.map(e=>e.raw_response.id))),p(e=>[...o.data.reverse(),...e]),t?z(e=>[...e,...o.processedFiles]):M(o.totalLines),setTimeout(()=>{F(new Set)},5e3),y({title:"New responses received",description:"".concat(o.data.length," new responses added")}))}catch(e){console.error("Error fetching responses:",e),y({variant:"destructive",title:"Error",description:"Failed to fetch new responses"})}},[s,C,P,t,y]),O=(0,h.useCallback)(async()=>{if(s)try{let e=new URLSearchParams({batchMode:t.toString(),...t?{processedFiles:""}:{lastLine:"0"}}),a=await fetch("/api/responses/".concat(s,"?").concat(e));if(!a.ok)throw Error("Failed to fetch responses");let{data:o,totalLines:n,processedFiles:l}=await a.json();o&&Array.isArray(o)&&(p(o.reverse()),t&&l?z(l):M(n),y({title:"Dataset loaded",description:"Loaded ".concat(o.length," responses")})),_(!0)}catch(e){console.error("Error reading responses file:",e),y({variant:"destructive",title:"Error",description:"Failed to load dataset"})}finally{R(!1)}},[s,t,y]);return((0,h.useEffect)(()=>{s&&T&&O()},[s,T,O]),(0,h.useEffect)(()=>{if(!k||!s||T)return;let e=setInterval(L,5e3);return()=>{clearInterval(e)}},[k,s,L,T]),g)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S,{item:b,onClose:()=>w(null)}),(0,a.jsxs)("div",{className:"min-h-screen bg-background text-foreground overflow-x-hidden",children:[(0,a.jsx)(o.h,{isLoading:T,isPolling:k,onTogglePolling:()=>_(e=>!e),loadingText:"Loading dataset...",pollingText:"Polling for updates..."}),(0,a.jsxs)("main",{className:"container mx-auto p-4 overflow-x-hidden",children:[(0,a.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-foreground",children:"Dataset Details"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"View and analyze your dataset responses"})]}),m.length>0&&(0,a.jsxs)(l.h_,{children:[(0,a.jsx)(l.$F,{asChild:!0,children:(0,a.jsx)(n.z,{variant:"outline",children:j?j.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"Select Metric"})}),(0,a.jsxs)(l.AW,{align:"end",children:[(0,a.jsx)(l.Xi,{onClick:()=>N(null),children:"None"}),["total_tokens","prompt_tokens","completion_tokens"].map(e=>(0,a.jsx)(l.Xi,{onClick:()=>N(e),children:"total_tokens"===e?"Total Tokens":"prompt_tokens"===e?"Prompt Tokens":"Completion Tokens"},e))]})]})]}),T?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)(u.Z,{className:"h-8 w-8 animate-spin"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading dataset..."})]})}):0===m.length?(0,a.jsx)(V,{batchMode:t,isPolling:k}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mb-8 space-y-4",children:j&&(0,a.jsx)("div",{className:"rounded-lg border bg-card p-4",children:(0,a.jsx)(D,{data:m,column:j})})}),(0,a.jsx)("div",{className:"rounded-lg border bg-card",children:(0,a.jsx)(c.M,{children:(0,a.jsx)(r.d,{columns:A,data:m,getRowKey:e=>e.raw_response.id,getCellContent:(e,s)=>(0,d.L1)(e,s),onRowClick:e=>w(e),truncateConfig:{enabled:!0,maxLength:150},pageSize:10,rowProps:e=>({className:(0,d.cn)(E.has(e.raw_response.id)&&"bg-success/30 animate-highlight","transition-colors duration-300"),layout:!0,initial:{opacity:0,y:-20},animate:{opacity:1,y:0,transition:{duration:.2}},exit:{opacity:0,y:-20,transition:{duration:.2}}})})})})]})]})]})]}):null}}},e=>{var s=s=>e(e.s=s);e.O(0,[237,764,883,130,215,744],()=>s(18513)),_N_E=e.O()}]);