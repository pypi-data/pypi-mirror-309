class CrossOriginInterface{static instances={};constructor(t){if(CrossOriginInterface.instances[t])return console.error("CrossOriginInterface instance already exists with key",t),CrossOriginInterface.instances[t];CrossOriginInterface.instances[t]=this,this.sortedAnchors=[],this.trackedAnchors=new Set,this.anchorVisibleStates={},this.activeAnchorId=null,this.component=null,this.autoUpdateAnchor=!1,this.key=t,this.styles=null,this.disable_scroll=!1,this.updateId=0,this.enroute=!1,window.addEventListener("message",this.handleMessage.bind(this))}register(t,e,s){this.component=t,this.autoUpdateAnchor=e,this.emphasisStyle=s,this.key}updateConfig(t,e){this.styles=t,this.disable_scroll=e}scroll(t){const e=document.getElementById(t);if(e){const s=this.disable_scroll?"instant":"smooth";this.anchorVisibleStates[t]||(this.enroute=!0),this.updateActiveAnchor(t),e.scrollIntoView({behavior:s,block:"start"})}this.emphasize(t)}emphasize(t){const e=document.getElementById(t);if(e){if(null===this.styles)return void console.error("Styles have not been set");const t=this.styles.anchorEmphasis||null;if(null===t)return void console.error("emphasisStyle has not been set");for(const s in t)e.style[s]=t[s];setTimeout((()=>{e.style.transform="scale(1)"}),600)}}updateActiveAnchor(t){this.trackedAnchors.has(t)?this.activeAnchorId=t:console.error("Anchor is not being tracked",t??"null")}checkBestAnchor(){if(!this.enroute&&this.activeAnchorId){if(this.anchorVisibleStates[this.activeAnchorId])return;let t=null;const e=this.sortedAnchors.indexOf(this.activeAnchorId);for(let s=e+1;s<this.sortedAnchors.length;s++){const e=this.sortedAnchors[s];if(this.anchorVisibleStates[e]){t=e;break}}if(null===t)for(let s=e-1;s>=0;s--){const e=this.sortedAnchors[s];if(this.anchorVisibleStates[e]){t=e;break}}null!==t&&(this.activeAnchorId=t,this.postUpdateActiveAnchor(this.activeAnchorId))}}postUpdateActiveAnchor(t){this.postMessage("updateActiveAnchor",{anchor_id:t,update_id:this.updateId++})}postMessage(t,e=({anchor_id:anchor_id=null,update_id:update_id=null}={})){null!==this.component?this.component.postMessage({COMPONENT_method:t,key:this.key,...e},"*"):console.error("Component has not been registered")}observer=new IntersectionObserver((t=>{t.forEach((t=>{const e=t.target.id;t.isIntersecting?(this.anchorVisibleStates[e]=!0,this.activeAnchorId===e&&(this.enroute=!1)):(this.anchorVisibleStates[e]=!1,this.activeAnchorId===e&&setTimeout((()=>{this.checkBestAnchor()}),0))}))}),{threshold:[0,1]});trackAnchors(t){for(const e of t){if(this.trackedAnchors.has(e))return;const t=document.getElementById(e);if(!t)return void console.error("Anchor does not exist",e);this.trackedAnchors.add(e);let s=!1;for(let o=0;o<this.sortedAnchors.length;o++){const i=document.getElementById(this.sortedAnchors[o]);if(t.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_FOLLOWING){this.sortedAnchors.splice(o,0,e),s=!0;break}}s||this.sortedAnchors.push(e),this.sortedAnchors.push(e),this.observer.observe(t)}}handleMessage(t){const{COI_method:e,key:s}=t.data;if(e&&s&&s===this.key){if(t.data,null===this.component)if("register"===e){const{auto_update_anchor:e,emphasis_style:s}=t.data;this.register(t.source,e,s)}else console.error("Must register component with this CrossOriginInterface before calling other methods",t.data);switch(e){case"register":break;case"updateConfig":const{styles:s,disable_scroll:o}=t.data;this.updateConfig(s,o);break;case"scroll":const{anchor_id:i}=t.data;this.scroll(i);break;case"trackAnchors":const{anchor_ids:n}=t.data;this.trackAnchors(n);break;case"updateActiveAnchor":const{anchor_id:r}=t.data;this.updateActiveAnchor(r);break;default:console.error("Unknown method",e)}}}}function instantiateCrossOriginInterface(t){return new CrossOriginInterface(t)}